<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProductPicks - Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --text-color: #1f2937;
            --light-text: #6b7280;
            --bg-color: #ffffff;
            --card-bg: #f9fafb;
            --border-color: #e5e7eb;
            --success-color: #10b981;
            --danger-color: #dc2626;
            --warning-color: #f59e0b;
            --admin-color: #7c3aed;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-color);
            background-color: #f8fafc;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        a { text-decoration: none; color: inherit; }
        img { max-width: 100%; height: auto; display: block; }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            text-align: center;
            font-size: 14px;
        }
        
        .btn:hover { background-color: var(--secondary-color); }
        .btn-small { padding: 8px 16px; font-size: 13px; }
        .btn-danger { background-color: var(--danger-color); }
        .btn-danger:hover { background-color: #b91c1c; }
        .btn-success { background-color: var(--success-color); }
        .btn-success:hover { background-color: #0da271; }
        .btn-warning { background-color: var(--warning-color); }
        .btn-warning:hover { background-color: #d97706; }
        .btn-admin { background-color: var(--admin-color); }
        .btn-admin:hover { background-color: #6d28d9; }
        
        /* Admin Header */
        .admin-header {
            background-color: var(--admin-color);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .admin-header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-logo {
            font-size: 24px;
            font-weight: 700;
            color: white;
        }
        
        .admin-logo span { color: #c4b5fd; }
        
        .admin-nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        .admin-nav a {
            color: #e2e8f0;
            font-weight: 500;
            padding: 5px 0;
            transition: color 0.3s ease;
        }
        
        .admin-nav a:hover, .admin-nav a.active {
            color: white;
            border-bottom: 2px solid white;
        }
        
        /* Admin Main */
        .admin-main {
            display: flex;
            min-height: calc(100vh - 70px);
        }
        
        /* Sidebar */
        .admin-sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid var(--border-color);
            padding: 30px 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
        }
        
        .admin-sidebar h3 {
            padding: 0 20px 15px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            font-size: 16px;
            color: var(--light-text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .sidebar-nav ul {
            list-style: none;
        }
        
        .sidebar-nav li {
            margin-bottom: 5px;
        }
        
        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .sidebar-nav a:hover {
            background-color: #f3f4f6;
            color: var(--primary-color);
        }
        
        .sidebar-nav a.active {
            background-color: #e0e7ff;
            color: var(--primary-color);
            border-left: 3px solid var(--primary-color);
        }
        
        .sidebar-nav i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* Admin Content */
        .admin-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .admin-content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .admin-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-color);
        }
        
        .admin-subtitle {
            color: var(--light-text);
            margin-bottom: 30px;
        }
        
        /* Dashboard Stats */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            border-left: 4px solid var(--primary-color);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
            color: white;
        }
        
        .stat-icon.products { background-color: var(--primary-color); }
        .stat-icon.trending { background-color: var(--warning-color); }
        .stat-icon.categories { background-color: var(--success-color); }
        .stat-icon.platforms { background-color: var(--admin-color); }
        
        .stat-info h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-info p {
            color: var(--light-text);
            font-size: 14px;
        }
        
        /* Products Table */
        .table-container {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .table-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .search-box {
            display: flex;
            align-items: center;
        }
        
        .search-input {
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px 0 0 6px;
            width: 250px;
        }
        
        .search-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 6px 6px 0;
            padding: 8px 15px;
            cursor: pointer;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background-color: #f8fafc;
            border-bottom: 2px solid var(--border-color);
        }
        
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-color);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }
        
        tbody tr:hover {
            background-color: #f9fafb;
        }
        
        .product-image-small {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-badge.trending {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-badge.regular {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--light-text);
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        
        .form-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        /* Alert */
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .alert i {
            margin-right: 10px;
            font-size: 18px;
        }
        
        .alert-success {
            background-color: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--success-color);
        }
        
        .alert-error {
            background-color: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--danger-color);
        }
        
        .alert-warning {
            background-color: #fef3c7;
            color: #92400e;
            border-left: 4px solid var(--warning-color);
        }
        
        /* Tag Input */
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            min-height: 50px;
        }
        
        .tag {
            display: inline-flex;
            align-items: center;
            background-color: #e0e7ff;
            color: var(--primary-color);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .tag-remove {
            margin-left: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .tag-input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 100px;
            padding: 5px;
        }
        
        /* Image Upload Styles */
        .image-upload-container {
            border: 2px dashed #4CAF50;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .image-upload-container:hover {
            border-color: #45a049;
            background-color: #f0f9f0;
        }
        
        .image-upload-container i {
            font-size: 60px;
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        .upload-button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
        }
        
        .upload-button:hover {
            background-color: #45a049;
        }
        
        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .image-preview {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .image-preview img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .image-preview .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-preview .set-main-btn {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background-color: rgba(33, 150, 243, 0.9);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .progress-container {
            margin: 20px 0;
            background-color: #f1f1f1;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            width: 0%;
            height: 20px;
            background-color: #4CAF50;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            padding: 10px;
            color: #666;
        }
        
        /* Platform Badges */
        .platform-badges {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .platform-badge {
            padding: 8px 16px;
            background-color: #f3f4f6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .platform-badge:hover {
            background-color: #e5e7eb;
        }
        
        .platform-badge.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
        }
        
        .empty-icon {
            font-size: 60px;
            color: #e5e7eb;
            margin-bottom: 20px;
        }
        
        .empty-title {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--text-color);
        }
        
        .empty-text {
            color: var(--light-text);
            margin-bottom: 30px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Mobile Responsive */
        @media (max-width: 992px) {
            .admin-main {
                flex-direction: column;
            }
            
            .admin-sidebar {
                width: 100%;
                padding: 20px 0;
            }
            
            .sidebar-nav ul {
                display: flex;
                overflow-x: auto;
                padding: 0 20px;
            }
            
            .sidebar-nav li {
                flex-shrink: 0;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .admin-header-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .admin-nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .table-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .search-box {
                width: 100%;
            }
            
            .search-input {
                width: 100%;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Panel Content -->
    <div id="adminPanel">
        <!-- Admin Header -->
        <header class="admin-header">
            <div class="container admin-header-container">
                <div class="admin-logo">Product<span>Picks</span> Admin</div>
                
                <nav class="admin-nav">
                    <ul>
                        <li><a href="#" onclick="switchSection('dashboard'); return false;">Dashboard</a></li>
                        <li><a href="#" onclick="switchSection('products'); return false;" class="active">Products</a></li>
                        <li><a href="#" onclick="logout(); return false;">Logout</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Admin Main -->
        <main class="admin-main">
            <!-- Sidebar -->
            <aside class="admin-sidebar">
                <h3>Management</h3>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" onclick="switchSection('dashboard'); return false;" id="dashboard-link">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a></li>
                        <li><a href="#" onclick="switchSection('products'); return false;" id="products-link" class="active">
                            <i class="fas fa-box-open"></i> All Products
                        </a></li>
                        <li><a href="#" onclick="switchSection('add-product'); return false;" id="add-product-link">
                            <i class="fas fa-plus-circle"></i> Add Product
                        </a></li>
                        <li><a href="#" onclick="switchSection('categories'); return false;" id="categories-link">
                            <i class="fas fa-tags"></i> Categories
                        </a></li>
                    </ul>
                </nav>
                
                <h3>Platforms</h3>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" onclick="filterByPlatform('all'); return false;">
                            <i class="fas fa-globe"></i> All Platforms
                        </a></li>
                        <li><a href="#" onclick="filterByPlatform('Amazon'); return false;">
                            <i class="fab fa-amazon"></i> Amazon
                        </a></li>
                        <li><a href="#" onclick="filterByPlatform('Flipkart'); return false;">
                            <i class="fas fa-shopping-cart"></i> Flipkart
                        </a></li>
                        <li><a href="#" onclick="filterByPlatform('Meesho'); return false;">
                            <i class="fas fa-store"></i> Meesho
                        </a></li>
                    </ul>
                </nav>
                
                <h3>Quick Actions</h3>
                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" onclick="refreshData(); return false;">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </a></li>
                        <li><a href="#" onclick="viewWebsite(); return false;">
                            <i class="fas fa-external-link-alt"></i> View Website
                        </a></li>
                    </ul>
                </nav>
            </aside>

            <!-- Admin Content -->
            <section class="admin-content">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="admin-section" style="display: none;">
                    <div class="admin-content-header">
                        <h1 class="admin-title">Dashboard</h1>
                        <div>
                            <button class="btn btn-admin" onclick="refreshData()">
                                <i class="fas fa-sync-alt"></i> Refresh Data
                            </button>
                        </div>
                    </div>
                    
                    <p class="admin-subtitle">Welcome to ProductPicks Admin Panel. Manage your products, categories, and trending items.</p>
                    
                    <!-- Dashboard Stats -->
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-icon products">
                                <i class="fas fa-box-open"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalProducts">0</h3>
                                <p>Total Products</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon trending">
                                <i class="fas fa-fire"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="trendingProducts">0</h3>
                                <p>Trending Products</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon categories">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalCategories">0</h3>
                                <p>Categories</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon platforms">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalPlatforms">0</h3>
                                <p>Platforms</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Products -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Recent Products</h3>
                            <button class="btn btn-small" onclick="switchSection('products')">
                                View All
                            </button>
                        </div>
                        
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Platform</th>
                                        <th>Category</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="recentProductsTable">
                                    <!-- Recent products will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Products Section -->
                <div id="products-section" class="admin-section" style="display: block;">
                    <div class="admin-content-header">
                        <h1 class="admin-title">All Products</h1>
                        <div>
                            <button class="btn btn-success" onclick="switchSection('add-product')">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                        </div>
                    </div>
                    
                    <!-- Alert Messages -->
                    <div id="alertContainer"></div>
                    
                    <!-- Products Table -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Products List</h3>
                            <div class="search-box">
                                <input type="text" class="search-input" id="productSearch" placeholder="Search products..." onkeyup="searchProducts()">
                                <button class="search-button" onclick="searchProducts()">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Product Name</th>
                                        <th>Platform</th>
                                        <th>Category</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTable">
                                    <!-- Products will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Add/Edit Product Section -->
                <div id="add-product-section" class="admin-section" style="display: none;">
                    <div class="admin-content-header">
                        <h1 class="admin-title" id="form-title">Add New Product</h1>
                        <div>
                            <button class="btn" onclick="switchSection('products')">
                                <i class="fas fa-arrow-left"></i> Back to Products
                            </button>
                        </div>
                    </div>
                    
                    <!-- Alert Messages -->
                    <div id="formAlertContainer"></div>
                    
                    <!-- Product Form -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Product Details</h3>
                        </div>
                        
                        <div style="padding: 20px;">
                            <form id="productForm" onsubmit="saveProduct(event)">
                                <input type="hidden" id="productId" value="">
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="productTitle">Product Title *</label>
                                        <input type="text" id="productTitle" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="productPlatform">Platform *</label>
                                        <div class="platform-badges">
                                            <span class="platform-badge" data-platform="Amazon" onclick="selectPlatform('Amazon')">Amazon</span>
                                            <span class="platform-badge" data-platform="Flipkart" onclick="selectPlatform('Flipkart')">Flipkart</span>
                                            <span class="platform-badge" data-platform="Meesho" onclick="selectPlatform('Meesho')">Meesho</span>
                                        </div>
                                        <input type="hidden" id="productPlatform" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="productCategory">Category *</label>
                                        <select id="productCategory" required>
                                            <option value="">Select Category</option>
                                            <option value="electronics">Electronics</option>
                                            <option value="fashion">Fashion</option>
                                            <option value="home">Home & Kitchen</option>
                                            <option value="beauty">Beauty</option>
                                            <option value="sports">Sports & Fitness</option>
                                            <option value="books">Books</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="affiliateLink">Affiliate Link *</label>
                                        <input type="url" id="affiliateLink" required placeholder="https://amazon.in/product-link">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="productDescription">Description *</label>
                                    <textarea id="productDescription" required></textarea>
                                </div>
                                
                                <!-- Image Upload Section -->
                                <div class="form-group">
                                    <label>Product Images *</label>
                                    <p style="color: var(--light-text); font-size: 14px; margin-bottom: 10px;">First image will be used as main display image</p>
                                    
                                    <div class="image-upload-container" id="imageUploadContainer">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <h4>Upload Product Images</h4>
                                        <p>Click to select images from your computer or drag and drop</p>
                                        <p style="font-size: 12px;">Supported formats: JPG, PNG, WebP (Max 5MB each)</p>
                                        <button type="button" class="upload-button" id="uploadImageBtn">
                                            <i class="fas fa-upload"></i> Select Images
                                        </button>
                                        <input type="file" id="imageFileInput" multiple accept="image/*" style="display: none;">
                                    </div>
                                    
                                    <!-- Progress Bar -->
                                    <div id="progressContainer" class="progress-container">
                                        <div class="progress-bar" id="progressBar"></div>
                                        <div class="progress-text" id="progressText"></div>
                                    </div>
                                    
                                    <!-- Image Preview -->
                                    <div class="image-preview-container" id="imagePreviewContainer">
                                        <!-- Image previews will appear here -->
                                    </div>
                                    
                                    <input type="hidden" id="productImages" value="[]">
                                </div>
                                
                                <div class="form-group">
                                    <label>Features (One per line) *</label>
                                    <textarea id="productFeatures" required placeholder="Enter each feature on a new line"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label>Tags</label>
                                    <div class="tag-container" id="tagContainer">
                                        <input type="text" class="tag-input" id="tagInput" placeholder="Type tag and press Enter">
                                    </div>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="isTrending">
                                    <label for="isTrending">Mark as Trending Product</label>
                                </div>
                                
                                <div class="form-footer">
                                    <button type="button" class="btn btn-danger" onclick="switchSection('products')">Cancel</button>
                                    <button type="submit" class="btn btn-success" id="saveButton">Save Product</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Categories Section -->
                <div id="categories-section" class="admin-section" style="display: none;">
                    <div class="admin-content-header">
                        <h1 class="admin-title">Categories</h1>
                        <div>
                            <button class="btn btn-success" onclick="addNewCategory()">
                                <i class="fas fa-plus"></i> Add Category
                            </button>
                        </div>
                    </div>
                    
                    <p class="admin-subtitle">Manage product categories</p>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">All Categories</h3>
                        </div>
                        
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Category Name</th>
                                        <th>Product Count</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="categoriesTable">
                                    <!-- Categories will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Delete</h3>
                <button class="modal-close" onclick="closeModal('deleteModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this product? This action cannot be undone.</p>
                <div class="form-footer">
                    <button type="button" class="btn" onclick="closeModal('deleteModal')">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete Product</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHJBo7tBSHpVBdhQ5V6dFm7pbtLWg-JbI",
            authDomain: "products-pick.firebaseapp.com",
            projectId: "products-pick",
            storageBucket: "products-pick.firebasestorage.app",
            messagingSenderId: "564920101956",
            appId: "1:564920101956:web:c941a00a6fd4a47c39e011",
            databaseURL: "https://products-pick-default-rtdb.firebaseio.com/"
        };
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();
        
        // Global Variables
        let adminProducts = [];
        let selectedProductId = null;
        let currentTags = [];
        let uploadedImages = [];
        let currentSection = 'products';
        
        // Initialize admin panel
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Admin Panel Initialized");
            
            // Load products
            loadProducts();
            
            // Initialize image upload
            initImageUpload();
            
            // Initialize tag input
            initTagInput();
            
            // Show current section
            switchSection('products');
        });
        
        // Initialize Image Upload
        function initImageUpload() {
            const uploadContainer = document.getElementById('imageUploadContainer');
            const fileInput = document.getElementById('imageFileInput');
            const uploadBtn = document.getElementById('uploadImageBtn');
            
            if (!uploadContainer || !fileInput) return;
            
            // Click on container to trigger file input
            uploadContainer.addEventListener('click', function() {
                fileInput.click();
            });
            
            // Handle file selection
            fileInput.addEventListener('change', handleImageSelection);
            
            // Drag and drop support
            uploadContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = '#45a049';
                this.style.backgroundColor = '#f0f9f0';
            });
            
            uploadContainer.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.borderColor = '#4CAF50';
                this.style.backgroundColor = '#f9f9f9';
            });
            
            uploadContainer.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = '#4CAF50';
                this.style.backgroundColor = '#f9f9f9';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageSelection({ target: { files: files } });
                }
            });
            
            // Upload button
            if (uploadBtn) {
                uploadBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    fileInput.click();
                });
            }
        }
        
        // Handle Image Selection
        function handleImageSelection(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;
            
            // Reset file input
            event.target.value = '';
            
            // Validate files
            const validFiles = [];
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Check file type
                if (!file.type.startsWith('image/')) {
                    showAlert(`File "${file.name}" is not an image`, 'error', 'formAlertContainer');
                    continue;
                }
                
                // Check file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showAlert(`File "${file.name}" is too large. Maximum size is 5MB`, 'error', 'formAlertContainer');
                    continue;
                }
                
                validFiles.push(file);
            }
            
            if (validFiles.length === 0) return;
            
            // Upload valid files
            uploadImagesToFirebase(validFiles);
        }
        
        // Upload Images to Firebase Storage
        function uploadImagesToFirebase(files) {
            const totalFiles = files.length;
            let uploadedCount = 0;
            
            // Show progress bar
            showProgressBar();
            
            // Upload each file
            files.forEach((file, index) => {
                uploadSingleImage(file, (downloadURL) => {
                    if (downloadURL) {
                        uploadedImages.push(downloadURL);
                        uploadedCount++;
                        
                        // Update progress
                        updateProgress(uploadedCount, totalFiles);
                        
                        // Update image preview
                        updateImagePreview();
                        
                        // If all files uploaded
                        if (uploadedCount === totalFiles) {
                            setTimeout(() => {
                                hideProgressBar();
                                showAlert(`${totalFiles} images uploaded successfully!`, 'success', 'formAlertContainer');
                            }, 500);
                        }
                    } else {
                        uploadedCount++;
                        if (uploadedCount === totalFiles) {
                            hideProgressBar();
                        }
                    }
                });
            });
        }
        
        // Upload Single Image to Firebase Storage
        function uploadSingleImage(file, callback) {
            // Create a unique filename
            const timestamp = Date.now();
            const randomString = Math.random().toString(36).substring(2, 15);
            const fileExtension = file.name.split('.').pop();
            const fileName = `product_${timestamp}_${randomString}.${fileExtension}`;
            
            // Create storage reference
            const storageRef = storage.ref();
            const imageRef = storageRef.child(`product-images/${fileName}`);
            
            // Upload the file
            const uploadTask = imageRef.put(file);
            
            // Monitor upload progress
            uploadTask.on('state_changed',
                (snapshot) => {
                    // Progress monitoring
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log(`Upload is ${progress}% done`);
                },
                (error) => {
                    console.error('Upload error:', error);
                    showAlert(`Error uploading image: ${error.message}`, 'error', 'formAlertContainer');
                    callback(null);
                },
                () => {
                    // Upload completed successfully
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        console.log('File available at:', downloadURL);
                        callback(downloadURL);
                    }).catch((error) => {
                        console.error('Error getting download URL:', error);
                        callback(null);
                    });
                }
            );
        }
        
        // Show Progress Bar
        function showProgressBar() {
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            if (progressContainer) {
                progressContainer.style.display = 'block';
                progressBar.style.width = '0%';
                progressText.textContent = 'Preparing upload...';
            }
        }
        
        // Update Progress
        function updateProgress(current, total) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            if (progressBar && progressText) {
                const percentage = (current / total) * 100;
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `Uploading ${current} of ${total} images (${Math.round(percentage)}%)`;
            }
        }
        
        // Hide Progress Bar
        function hideProgressBar() {
            const progressContainer = document.getElementById('progressContainer');
            if (progressContainer) {
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    progressBar.style.width = '0%';
                }, 1000);
            }
        }
        
        // Update Image Preview
        function updateImagePreview() {
            const previewContainer = document.getElementById('imagePreviewContainer');
            if (!previewContainer) return;
            
            previewContainer.innerHTML = '';
            
            if (uploadedImages.length === 0) {
                previewContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-images" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>No images uploaded yet</p>
                    </div>
                `;
                return;
            }
            
            uploadedImages.forEach((imageUrl, index) => {
                const isMain = index === 0;
                
                const previewDiv = document.createElement('div');
                previewDiv.className = 'image-preview';
                previewDiv.innerHTML = `
                    <img src="${imageUrl}" alt="Product Image ${index + 1}" 
                         onerror="this.src='https://via.placeholder.com/150x150?text=Image+Error'">
                    <button class="remove-btn" onclick="removeImage(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                    ${!isMain ? `
                        <button class="set-main-btn" onclick="setMainImage(${index})">
                            Set as Main
                        </button>
                    ` : `
                        <div style="position: absolute; bottom: 5px; left: 5px; background-color: rgba(33, 150, 243, 0.9); color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                            Main Image
                        </div>
                    `}
                `;
                
                previewContainer.appendChild(previewDiv);
            });
            
            // Update hidden input
            document.getElementById('productImages').value = JSON.stringify(uploadedImages);
        }
        
        // Remove Image
        function removeImage(index) {
            if (confirm('Are you sure you want to remove this image?')) {
                uploadedImages.splice(index, 1);
                updateImagePreview();
                showAlert('Image removed', 'success', 'formAlertContainer');
            }
        }
        
        // Set Main Image
        function setMainImage(index) {
            if (index === 0) return; // Already main
            
            // Move image to first position
            const image = uploadedImages.splice(index, 1)[0];
            uploadedImages.unshift(image);
            
            updateImagePreview();
            showAlert('Main image updated', 'success', 'formAlertContainer');
        }
        
        // Select Platform
        function selectPlatform(platform) {
            // Update badges
            document.querySelectorAll('.platform-badge').forEach(badge => {
                if (badge.dataset.platform === platform) {
                    badge.classList.add('active');
                } else {
                    badge.classList.remove('active');
                }
            });
            
            // Update hidden input
            document.getElementById('productPlatform').value = platform;
        }
        
        // Load products from Firebase
        function loadProducts() {
            showLoading('productsTable', 'Loading products...');
            
            const productsRef = database.ref('products');
            
            productsRef.once('value')
                .then((snapshot) => {
                    const firebaseData = snapshot.val();
                    
                    if (firebaseData) {
                        // Convert Firebase object to array
                        adminProducts = Object.values(firebaseData);
                        
                        // Add IDs to products
                        adminProducts.forEach((product, index) => {
                            product.id = index + 1;
                            
                            // Ensure all products have required fields
                            if (!product.tags) product.tags = [];
                            if (!product.features) product.features = [];
                            if (!product.trending) product.trending = false;
                            if (!product.category) product.category = 'electronics';
                            if (!product.platform) product.platform = 'Amazon';
                            if (!product.images) product.images = [];
                            if (product.image && !product.images.includes(product.image)) {
                                product.images.unshift(product.image);
                            }
                        });
                        
                        console.log(`Loaded ${adminProducts.length} products`);
                        
                        // Update UI
                        updateDashboardStats();
                        displayProductsTable();
                        displayRecentProducts();
                        updateCategoriesTable();
                        
                        showAlert('Products loaded successfully', 'success');
                    } else {
                        console.log('No products found');
                        adminProducts = [];
                        showAlert('No products found. Add your first product!', 'info');
                    }
                })
                .catch((error) => {
                    console.error('Error loading products:', error);
                    showAlert('Error loading products from database', 'error');
                });
        }
        
        // Update Dashboard Statistics
        function updateDashboardStats() {
            // Total products
            document.getElementById('totalProducts').textContent = adminProducts.length;
            
            // Trending products count
            const trendingCount = adminProducts.filter(p => p.trending).length;
            document.getElementById('trendingProducts').textContent = trendingCount;
            
            // Categories count
            const categories = [...new Set(adminProducts.map(p => p.category))];
            document.getElementById('totalCategories').textContent = categories.length;
            
            // Platforms count
            const platforms = [...new Set(adminProducts.map(p => p.platform))];
            document.getElementById('totalPlatforms').textContent = platforms.length;
        }
        
        // Display Products Table
        function displayProductsTable(filteredProducts = null) {
            const productsToDisplay = filteredProducts || adminProducts;
            const tableBody = document.getElementById('productsTable');
            
            if (!tableBody) return;
            
            if (productsToDisplay.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state" style="padding: 20px;">
                            <div class="empty-icon">
                                <i class="fas fa-box-open"></i>
                            </div>
                            <div class="empty-title">No Products Found</div>
                            <div class="empty-text">${filteredProducts ? 'No products match your search' : 'Add products to display them here'}</div>
                            <button class="btn" onclick="switchSection('add-product')">Add Product</button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let tableHTML = '';
            
            productsToDisplay.forEach(product => {
                const mainImage = product.images && product.images.length > 0 ? product.images[0] : product.image || 'https://via.placeholder.com/60x60?text=No+Image';
                
                tableHTML += `
                    <tr>
                        <td>
                            <img src="${mainImage}" alt="${product.title}" class="product-image-small" onerror="this.src='https://via.placeholder.com/60x60?text=No+Image'">
                        </td>
                        <td>
                            <strong>${product.title}</strong><br>
                            <small style="color: var(--light-text);">${product.description.substring(0, 50)}...</small>
                        </td>
                        <td>${product.platform}</td>
                        <td>${product.category}</td>
                        <td>
                            <span class="status-badge ${product.trending ? 'trending' : 'regular'}">
                                ${product.trending ? 'Trending' : 'Regular'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-small" onclick="editProduct(${product.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-small btn-danger" onclick="deleteProduct(${product.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }
        
        // Display Recent Products
        function displayRecentProducts() {
            const tableBody = document.getElementById('recentProductsTable');
            
            if (!tableBody) return;
            
            if (adminProducts.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state" style="padding: 20px;">
                            <div class="empty-icon">
                                <i class="fas fa-box-open"></i>
                            </div>
                            <div class="empty-title">No Products Yet</div>
                            <div class="empty-text">Add your first product to get started</div>
                            <button class="btn" onclick="switchSection('add-product')">Add Product</button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Get recent products (last 5 added)
            const recentProducts = [...adminProducts].reverse().slice(0, 5);
            
            let tableHTML = '';
            
            recentProducts.forEach(product => {
                tableHTML += `
                    <tr>
                        <td>
                            <strong>${product.title}</strong><br>
                            <small style="color: var(--light-text);">${product.description.substring(0, 30)}...</small>
                        </td>
                        <td>${product.platform}</td>
                        <td>${product.category}</td>
                        <td>
                            <span class="status-badge ${product.trending ? 'trending' : 'regular'}">
                                ${product.trending ? 'Trending' : 'Regular'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-small" onclick="editProduct(${product.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }
        
        // Update Categories Table
        function updateCategoriesTable() {
            const tableBody = document.getElementById('categoriesTable');
            if (!tableBody) return;
            
            // Count products by category
            const categoryCounts = {};
            adminProducts.forEach(product => {
                const category = product.category || 'uncategorized';
                categoryCounts[category] = (categoryCounts[category] || 0) + 1;
            });
            
            if (Object.keys(categoryCounts).length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="empty-state" style="padding: 20px;">
                            <div class="empty-icon">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="empty-title">No Categories Yet</div>
                            <div class="empty-text">Add products to see categories</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let tableHTML = '';
            
            Object.keys(categoryCounts).forEach(category => {
                const count = categoryCounts[category];
                const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
                
                tableHTML += `
                    <tr>
                        <td>
                            <strong>${categoryName}</strong><br>
                            <small style="color: var(--light-text);">${category}</small>
                        </td>
                        <td>${count} products</td>
                        <td>
                            <button class="btn btn-small" onclick="filterByCategory('${category}')">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }
        
        // Save Product
        function saveProduct(event) {
            if (event) event.preventDefault();
            
            // Get form values
            const productId = document.getElementById('productId').value;
            const title = document.getElementById('productTitle').value.trim();
            const platform = document.getElementById('productPlatform').value;
            const category = document.getElementById('productCategory').value;
            const description = document.getElementById('productDescription').value.trim();
            const affiliateLink = document.getElementById('affiliateLink').value.trim();
            const featuresText = document.getElementById('productFeatures').value.trim();
            const isTrending = document.getElementById('isTrending').checked;
            
            // Get images
            let images = [];
            try {
                images = JSON.parse(document.getElementById('productImages').value);
            } catch (e) {
                images = uploadedImages;
            }
            
            // Validation
            if (!title || !platform || !category || !description || !affiliateLink || !featuresText) {
                showAlert('Please fill in all required fields', 'error', 'formAlertContainer');
                return;
            }
            
            if (images.length === 0) {
                showAlert('Please upload at least one product image', 'error', 'formAlertContainer');
                return;
            }
            
            // Convert features to array
            const features = featuresText.split('\n')
                .map(f => f.trim())
                .filter(f => f.length > 0);
            
            if (features.length === 0) {
                showAlert('Please add at least one product feature', 'error', 'formAlertContainer');
                return;
            }
            
            // Create product object
            const product = {
                id: productId ? parseInt(productId) : adminProducts.length + 1,
                title: title,
                platform: platform,
                category: category,
                description: description,
                affiliateLink: affiliateLink,
                features: features,
                tags: currentTags,
                trending: isTrending,
                images: images,
                image: images[0] // First image is main
            };
            
            // Show loading
            const saveBtn = document.getElementById('saveButton');
            const originalText = saveBtn.textContent;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            saveBtn.disabled = true;
            
            // Save to Firebase
            saveProductToFirebase(product, productId);
        }
        
        // Save product to Firebase
        function saveProductToFirebase(product, existingProductId) {
            const productIndex = existingProductId ? 
                adminProducts.findIndex(p => p.id === parseInt(existingProductId)) : -1;
            
            // Prepare data for Firebase (remove id field)
            const productData = {
                title: product.title,
                platform: product.platform,
                category: product.category,
                description: product.description,
                affiliateLink: product.affiliateLink,
                features: product.features,
                tags: product.tags,
                trending: product.trending,
                images: product.images,
                image: product.image
            };
            
            // Determine Firebase path
            let firebasePath;
            if (productIndex !== -1) {
                // Update existing product
                firebasePath = `products/${productIndex}`;
            } else {
                // Add new product
                firebasePath = `products/${adminProducts.length}`;
            }
            
            // Save to Firebase
            database.ref(firebasePath).set(productData)
                .then(() => {
                    console.log('Product saved to Firebase');
                    
                    // Update local array
                    if (productIndex !== -1) {
                        adminProducts[productIndex] = product;
                    } else {
                        adminProducts.push(product);
                    }
                    
                    // Update UI
                    updateDashboardStats();
                    displayProductsTable();
                    displayRecentProducts();
                    updateCategoriesTable();
                    
                    // Show success message
                    showAlert(`Product ${existingProductId ? 'updated' : 'added'} successfully!`, 'success');
                    
                    // Reset form
                    resetProductForm();
                    
                    // Switch to products list
                    setTimeout(() => {
                        switchSection('products');
                    }, 1500);
                })
                .catch((error) => {
                    console.error('Error saving product:', error);
                    showAlert('Error saving product to database: ' + error.message, 'error', 'formAlertContainer');
                    
                    // Reset button
                    const saveBtn = document.getElementById('saveButton');
                    saveBtn.textContent = originalText;
                    saveBtn.disabled = false;
                });
        }
        
        // Reset Product Form
        function resetProductForm() {
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('form-title').textContent = 'Add New Product';
            document.getElementById('saveButton').textContent = 'Save Product';
            document.getElementById('productPlatform').value = '';
            document.querySelectorAll('.platform-badge').forEach(badge => {
                badge.classList.remove('active');
            });
            currentTags = [];
            uploadedImages = [];
            updateTagDisplay();
            updateImagePreview();
            document.getElementById('productImages').value = '[]';
        }
        
        // Edit Product
        function editProduct(productId) {
            const product = adminProducts.find(p => p.id === productId);
            if (!product) return;
            
            // Fill form
            document.getElementById('productId').value = product.id;
            document.getElementById('productTitle').value = product.title;
            document.getElementById('affiliateLink').value = product.affiliateLink;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productFeatures').value = Array.isArray(product.features) ? 
                product.features.join('\n') : '';
            document.getElementById('isTrending').checked = product.trending || false;
            
            // Set platform
            selectPlatform(product.platform);
            
            // Set category
            document.getElementById('productCategory').value = product.category;
            
            // Set tags
            currentTags = product.tags || [];
            updateTagDisplay();
            
            // Set images
            uploadedImages = product.images || [];
            if (product.image && !uploadedImages.includes(product.image)) {
                uploadedImages.unshift(product.image);
            }
            updateImagePreview();
            
            // Update form title
            document.getElementById('form-title').textContent = 'Edit Product';
            document.getElementById('saveButton').textContent = 'Update Product';
            
            // Switch to add product section
            switchSection('add-product');
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Initialize Tag Input
        function initTagInput() {
            const tagInput = document.getElementById('tagInput');
            const tagContainer = document.getElementById('tagContainer');
            
            if (!tagInput || !tagContainer) return;
            
            // Add tag when Enter is pressed
            tagInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const tag = tagInput.value.trim();
                    
                    if (tag && !currentTags.includes(tag)) {
                        currentTags.push(tag);
                        updateTagDisplay();
                        tagInput.value = '';
                    }
                }
            });
            
            // Add tag when input loses focus
            tagInput.addEventListener('blur', function() {
                const tag = tagInput.value.trim();
                
                if (tag && !currentTags.includes(tag)) {
                    currentTags.push(tag);
                    updateTagDisplay();
                    tagInput.value = '';
                }
            });
        }
        
        // Update Tag Display
        function updateTagDisplay() {
            const tagContainer = document.getElementById('tagContainer');
            if (!tagContainer) return;
            
            // Clear existing tags except input
            const tagInput = document.getElementById('tagInput');
            tagContainer.innerHTML = '';
            
            // Add tags
            currentTags.forEach((tag, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${tag}
                    <span class="tag-remove" onclick="removeTag(${index})">
                        <i class="fas fa-times"></i>
                    </span>
                `;
                tagContainer.appendChild(tagElement);
            });
            
            // Add input back
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'tag-input';
            input.id = 'tagInput';
            input.placeholder = 'Type tag and press Enter';
            tagContainer.appendChild(input);
            
            // Re-initialize event listeners
            initTagInput();
        }
        
        // Remove Tag
        function removeTag(index) {
            currentTags.splice(index, 1);
            updateTagDisplay();
        }
        
        // Delete Product
        function deleteProduct(productId) {
            selectedProductId = productId;
            openModal('deleteModal');
        }
        
        // Confirm Delete
        function confirmDelete() {
            if (!selectedProductId) return;
            
            const productIndex = adminProducts.findIndex(p => p.id === selectedProductId);
            if (productIndex === -1) return;
            
            // Show loading
            showLoading('productsTable', 'Deleting product...');
            
            // Remove from Firebase
            database.ref(`products/${productIndex}`).remove()
                .then(() => {
                    console.log('Product deleted from Firebase');
                    
                    // Remove from local array
                    adminProducts.splice(productIndex, 1);
                    
                    // Re-index products for Firebase
                    updateAllProductsInFirebase();
                    
                    // Update UI
                    updateDashboardStats();
                    displayProductsTable();
                    displayRecentProducts();
                    updateCategoriesTable();
                    
                    // Show success message
                    showAlert('Product deleted successfully', 'success');
                    
                    // Close modal
                    closeModal('deleteModal');
                    selectedProductId = null;
                })
                .catch((error) => {
                    console.error('Error deleting product from Firebase:', error);
                    showAlert('Error deleting product from database', 'error');
                    closeModal('deleteModal');
                });
        }
        
        // Update all products in Firebase
        function updateAllProductsInFirebase() {
            // Prepare products for Firebase (remove id field)
            const firebaseProducts = adminProducts.map(product => {
                const { id, ...productData } = product;
                return productData;
            });
            
            // Update entire products array in Firebase
            database.ref('products').set(firebaseProducts)
                .then(() => {
                    console.log('Firebase products updated');
                })
                .catch((error) => {
                    console.error('Error updating Firebase products:', error);
                });
        }
        
        // Switch Section
        function switchSection(sectionName) {
            currentSection = sectionName;
            
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Remove active class from all sidebar links
            document.querySelectorAll('.sidebar-nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Remove active class from all header links
            document.querySelectorAll('.admin-nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            const section = document.getElementById(sectionName + '-section');
            if (section) {
                section.style.display = 'block';
            }
            
            // Update active sidebar link
            const sidebarLink = document.getElementById(sectionName + '-link');
            if (sidebarLink) {
                sidebarLink.classList.add('active');
            }
            
            // Update active header link
            if (sectionName === 'dashboard' || sectionName === 'products') {
                document.querySelectorAll('.admin-nav a').forEach(link => {
                    if (link.textContent.includes(sectionName.charAt(0).toUpperCase() + sectionName.slice(1))) {
                        link.classList.add('active');
                    }
                });
            }
            
            // Special handling for add-product section
            if (sectionName === 'add-product') {
                document.getElementById('products-link').classList.add('active');
            }
        }
        
        // Filter by Platform
        function filterByPlatform(platform) {
            if (platform === 'all') {
                displayProductsTable();
                showAlert('Showing all products', 'success');
            } else {
                const filteredProducts = adminProducts.filter(p => p.platform === platform);
                displayProductsTable(filteredProducts);
                showAlert(`Showing products from ${platform}`, 'success');
            }
            
            // Switch to products section
            switchSection('products');
        }
        
        // Filter by Category
        function filterByCategory(category) {
            const filteredProducts = adminProducts.filter(p => p.category === category);
            displayProductsTable(filteredProducts);
            
            const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
            showAlert(`Showing products in ${categoryName} category`, 'success');
            
            // Switch to products section
            switchSection('products');
        }
        
        // Search Products
        function searchProducts() {
            const searchInput = document.getElementById('productSearch');
            const query = searchInput ? searchInput.value.trim().toLowerCase() : '';
            
            if (query === '') {
                displayProductsTable();
                return;
            }
            
            const filteredProducts = adminProducts.filter(product => {
                const searchText = (
                    (product.title || '').toLowerCase() + 
                    ' ' + (product.description || '').toLowerCase() + 
                    ' ' + (product.category || '').toLowerCase() +
                    ' ' + (product.platform || '').toLowerCase() +
                    ' ' + (product.tags || []).join(' ')
                ).toLowerCase();
                
                return searchText.includes(query);
            });
            
            displayProductsTable(filteredProducts);
            
            if (filteredProducts.length === 0) {
                showAlert(`No products found for "${query}"`, 'warning');
            }
        }
        
        // Add New Category
        function addNewCategory() {
            const categoryName = prompt('Enter new category name:');
            
            if (categoryName && categoryName.trim()) {
                // Update category dropdown
                const categorySelect = document.getElementById('productCategory');
                const newOption = document.createElement('option');
                newOption.value = categoryName.toLowerCase().replace(/\s+/g, '-');
                newOption.textContent = categoryName;
                categorySelect.appendChild(newOption);
                
                showAlert(`Category "${categoryName}" added`, 'success');
            }
        }
        
        // Refresh Data
        function refreshData() {
            loadProducts();
            showAlert('Refreshing data from Firebase...', 'success');
        }
        
        // View Website
        function viewWebsite() {
            window.open('index.html', '_blank');
        }
        
        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                alert('Logged out successfully');
                // In a real app, you would redirect to login page
            }
        }
        
        // Show Alert
        function showAlert(message, type = 'success', containerId = 'alertContainer') {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const alertClass = type === 'success' ? 'alert-success' : 
                              type === 'error' ? 'alert-error' : 'alert-warning';
            
            const icon = type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-exclamation-circle' : 'fa-exclamation-triangle';
            
            const alert = document.createElement('div');
            alert.className = `alert ${alertClass}`;
            alert.innerHTML = `
                <i class="fas ${icon}"></i>
                ${message}
            `;
            
            container.innerHTML = '';
            container.appendChild(alert);
            
            // Remove alert after 5 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }
        
        // Show Loading
        function showLoading(elementId, message = 'Loading...') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px;">
                        <div class="loading-spinner" style="margin: 0 auto 15px;"></div>
                        <div style="color: var(--light-text);">${message}</div>
                    </td>
                </tr>
            `;
        }
        
        // Open Modal
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
            }
        }
        
        // Close Modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }
    </script>
</body>
</html>